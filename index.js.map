{"version":3,"file":"index.js","sources":["index.ts"],"sourcesContent":["/**\r\n Box2d basics, uses debugdraw\r\n Silver Moon\r\n m00n.silv3r@gmail.com\r\n */\r\n\r\nimport $ from \"jquery\"\r\nimport Konva from \"konva\";\r\n\r\nvar world;\r\nvar ctx;\r\nvar canvas_width;\r\nvar canvas_height;\r\n\r\n//box2d to canvas scale , therefor 1 metre of box2d = 100px of canvas :)\r\nvar scale = 100;\r\n\r\nconst stage = new Konva.Stage({\r\n    container: '#stage',\r\n    height: 320,\r\n    width: 640\r\n})\r\n\r\n/*\r\n\tDraw a world\r\n\tthis method is called in a loop to redraw the world\r\n*/\r\nfunction draw_world(world: GCBox2D.World, context) {\r\n\r\n}\r\n\r\n//Create box2d world object\r\nfunction createWorld(): GCBox2D.World {\r\n    //Gravity vector x, y - 10 m/s2 - thats earth!!\r\n    var gravity = new GCBox2D.Vec2(0, -10);\r\n\r\n    world = new GCBox2D.World(gravity , true );\r\n\r\n    //createGround(world);\r\n    let ground = createBox(world, 4, 1, 4, 0.5, {type: GCBox2D.BodyType.b2_staticBody});\r\n\r\n    return world;\r\n}\r\n\r\n//Create a ground below the hellow world boxes\r\nfunction createGround(world)\r\n{\r\n    var bodyDef = new GCBox2D.BodyDef();\r\n\r\n    var fixDef = new GCBox2D.FixtureDef();\r\n    fixDef.density = 1.0;\r\n    fixDef.friction = 1.0;\r\n    fixDef.restitution = 0.5;\r\n\r\n    const shape = new GCBox2D.PolygonShape()\r\n    shape.SetAsBox(4, .5)\r\n\r\n    fixDef.shape = shape\r\n\r\n    //set the position of the center\r\n    bodyDef.position.Set(4.10 , 1);\r\n\r\n    return world.CreateBody(bodyDef).CreateFixture(fixDef);\r\n}\r\n\r\n//Function to create a ball\r\nfunction createBall(world, x, y, r, options)\r\n{\r\n    var body_def = new GCBox2D.BodyDef();\r\n    var fix_def = new GCBox2D.FixtureDef;\r\n\r\n    fix_def.density = 1.0;\r\n    fix_def.friction = 0.5;\r\n    fix_def.restitution = 0.5;\r\n\r\n    var shape = new GCBox2D.CircleShape(r);\r\n    fix_def.shape = shape;\r\n\r\n    body_def.position.Set(x , y);\r\n\r\n    body_def.linearDamping = 0.0;\r\n    body_def.angularDamping = 0.0;\r\n\r\n    body_def.type = GCBox2D.BodyType.b2_dynamicBody;\r\n    body_def.userData = options.user_data;\r\n\r\n    var b = world.CreateBody( body_def );\r\n    b.CreateFixture(fix_def);\r\n\r\n    return b;\r\n}\r\n\r\n//Create some elements\r\nfunction createHelloWorld()\r\n{\r\n    // H\r\n    createBox(world, .5 , 2.2, .1, .2);\r\n\r\n    createBox(world, .9 , 2.2 , .1, .2);\r\n    createBox(world, .7 , 1.95 , .3, .05);\r\n    createBox(world, .5 , 1.7 , .1 , .2);\r\n    createBox(world, .9 , 1.7 , .1 , .2);\r\n}\r\n\r\n//Create standard boxes of given height , width at x,y\r\nfunction createBox(world, x, y, width, height, options?)\r\n{\r\n    //default setting\r\n    options = $.extend(true, {\r\n        'density' : 1.0 ,\r\n        'friction' : 1.0 ,\r\n        'restitution' : 0.5 ,\r\n\r\n        'linearDamping' : 0.0 ,\r\n        'angularDamping' : 0.0 ,\r\n\r\n        'type' : GCBox2D.BodyType.b2_dynamicBody\r\n    }, options);\r\n\r\n    var body_def = new GCBox2D.BodyDef();\r\n    var fix_def = new GCBox2D.FixtureDef();\r\n\r\n    fix_def.density = options.density;\r\n    fix_def.friction = options.friction;\r\n    fix_def.restitution = options.restitution;\r\n\r\n    fix_def.shape = new GCBox2D.PolygonShape();\r\n\r\n    const shape = new GCBox2D.PolygonShape()\r\n    shape.SetAsBox(width, height)\r\n\r\n    fix_def.shape = shape\r\n\r\n    body_def.position.Set(x , y);\r\n\r\n    body_def.linearDamping = options.linearDamping;\r\n    body_def.angularDamping = options.angularDamping;\r\n\r\n    body_def.type = options.type;\r\n    body_def.userData = options.user_data;\r\n\r\n    var b = world.CreateBody( body_def );\r\n    var f = b.CreateFixture(fix_def);\r\n\r\n    return b;\r\n}\r\n\r\n/*\r\n\tThis method will draw the world again and again\r\n\tcalled by settimeout , self looped\r\n*/\r\nfunction step()\r\n{\r\n    var fps = 60;\r\n    var timeStep = 1.0/fps;\r\n\r\n    //move the world ahead , step ahead man!!\r\n    world.Step(timeStep , 8 , 3);\r\n    world.ClearForces();\r\n\r\n    draw_world(world, ctx);\r\n}\r\n\r\n/*\r\n\tConvert coordinates in canvas to box2d world\r\n*/\r\nfunction get_real(p)\r\n{\r\n    return new GCBox2D.Vec2(p.x + 0, 6 - p.y);\r\n}\r\n\r\n// main entry point\r\n$(function()\r\n{\r\n    var canvas = $('#canvas');\r\n    ctx = (canvas.get(0) as HTMLCanvasElement).getContext('2d');\r\n\r\n    //first create the world\r\n    world = createWorld();\r\n\r\n    //get internal dimensions of the canvas\r\n    canvas_width = parseInt(canvas.attr('width'));\r\n    canvas_height = parseInt(canvas.attr('height'));\r\n\r\n    //create the hello world boxes in the world\r\n    createHelloWorld();\r\n\r\n    //click event handler on our world\r\n    canvas.click( function(e)\r\n    {\r\n        var p = get_real(new GCBox2D.Vec2(e.clientX / scale, e.clientY / scale));\r\n\r\n        //create shape\r\n        if (Math.random() > 0.5)\r\n        {\r\n            //Square box\r\n            createBox(world, p.x , p.y , .1 , .1);\r\n        }\r\n        else\r\n        {\r\n            //circle\r\n            createBall(world, p.x , p.y, 0.2, {'user_data' : {'fill_color' : 'rgba(204,100,0,0.3)' , 'border_color' : '#555' }});\r\n        }\r\n    });\r\n\r\n    window.setInterval(step, 1000 / 60);\r\n});"],"names":["Konva","$"],"mappings":"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"}